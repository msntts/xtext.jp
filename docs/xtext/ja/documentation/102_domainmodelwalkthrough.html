<!DOCTYPE html>
<html>

  <head>
	<meta charset="UTF-8">
	<title>Xtext - 15分チュートリアル</title>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description"
		content="The website of Eclipse Xtext, an open-source framework for development of programming languages and domain-specific languages">
	<meta name="author" content="Sven Efftinge">
	<meta name="author" content="Miro Spoenemann">
	<!--  styles -->
	<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
	  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	
	<!-- Le fav and touch icons -->
	<link rel="shortcut icon" href="/Xtext/images/favicon.png">
	
	<link href="/Xtext/css/bootstrap.css" rel="stylesheet" type='text/css'>
	<link href="/Xtext/css/bootstrap-responsive.css" rel="stylesheet" type='text/css'>
	<link href="/Xtext/css/shield-responsive.css" rel="stylesheet" type='text/css'>
	<link href='/Xtext/css/fonts.css' rel='stylesheet' type='text/css'>
	<link href="/Xtext/css/prettyPhoto.css" rel="stylesheet" media="screen" type='text/css'>
	<link href="/Xtext/css/prettify.css" type="text/css" rel="stylesheet"/>
	<link href="/Xtext/css/style.css" rel="stylesheet" type='text/css'>
	<!-- cover flow -->
	<link href="/Xtext/css/coverflow.css" rel="stylesheet" type='text/css'>
	<!--[if lt IE 9]>
	  <link href="/css/iebugs.css" rel="stylesheet" type='text/css'>
	<![endif]-->

	<!-- BEGIN Cookie Consent
	<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
	<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
	<script>
	window.addEventListener("load", function(){
	window.cookieconsent.initialise({
		"palette": {
		"popup": {
		  "background": "#000"
		},
		"button": {
		  "background": "#f1d600"
		}
		},
		"theme": "edgeless",
		"type": "opt-in",
		onInitialise: function (status) {
		  var type = this.options.type;
		  var didConsent = this.hasConsented();
		  if (type == 'opt-in' && didConsent) {
		    // TODO: enable cookies
		  }
		  if (type == 'opt-out' && !didConsent) {
		    // TODO: disable cookies
		  }
		},
		onStatusChange: function(status, chosenBefore) {
		  var type = this.options.type;
		  var didConsent = this.hasConsented();
		  if (type == 'opt-in' && didConsent) {
		    // TODO: enable cookies
		  }
		  if (type == 'opt-out' && !didConsent) {
		    // TODO: disable cookies
		  }
		}, 
		onRevokeChoice: function() {
		  var type = this.options.type;
		  if (type == 'opt-in') {
		    // TODO: disable cookies
		  }
		  if (type == 'opt-out') {
		    // TODO: enable cookies
		  }
		},
		"content": {
		"href": "http://www.eclipse.org/legal/privacy.php"
		}
	})});
	</script>
	END Cookie Consent -->
</head>


  <body>
  
    <header class="site-header">

  <!-- Navbar -->
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse"
          data-target=".nav-collapse"> <span class="icon-bar"></span> <span
          class="icon-bar"></span> <span class="icon-bar"></span>
        </a> <a class="brand" href="/Xtext/index.html"></a>
        <div class="nav-collapse collapse" style="height: 0px;">
          <ul class="nav">
            <!--li ><a href="/Xtext/news.html">News</a></li-->
            <li ><a href="/Xtext/download.html">Download</a></li>
            <li ><a href="/Xtext/documentation/index.html">Documentation</a></li>
            <li ><a href="/Xtext/community.html">Community</a></li>
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Support &amp; Trainings<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="https://www.itemis.com/en/xtext/support-and-team/" target="_blank">itemis</a></li>
                <li><a href="https://typefox.io/trainings-2" target="_blank">TypeFox</a></li>
              </ul>
            </li>
            <li ><a href="http://xtend-lang.org">Xtend</a></li>
          </ul>
          <!--div class="nav pull-right">
            <li ><a><iframe src="https://ghbtns.com/github-btn.html?user=eclipse&repo=xtext&type=star&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe></a></li>
          </div-->
        </div>
        <!--/.nav-collapse -->
      </div>
    </div>
  </div>
  <!-- Navbar End -->

</header>


    <div class="page-content">
  <script>
    function startSearch(event) {
        if (event.keyCode == 13) {
            var q = 'site:eclipse.org/Xtext/documentation+' + event.target.value;
            window.open('https://www.google.com/search?q=' + q, "_self");
        }
    }
  </script>
  <div class="wrapper">
  	<div id="page">  
      <div class="inner">
        <div id="maincontainer" class="container">
          <span class="edit-on-github pull-right">
            <a href="https://github.com/eclipse/xtext/edit/website-published/xtext-website/ja/documentation/102_domainmodelwalkthrough.md">Edit on Github</a>
          </span>
          <div class="span3" style="margin-left: 0px;">
            <div class="search-bar">
              <img src="/Xtext/images/search-gray.png"/>
              <input type="search" id="google-search" onkeyup="startSearch(event);"/>
            </div>
            <ul id="nav-outline" style="margin-left: 0px;">
	<li class="nav-part">Getting Started</li>
	<li><a href="102_domainmodelwalkthrough.html">15 Minutes Tutorial</a></li>
	<li><a href="103_domainmodelnextsteps.html">15 Minutes Tutorial - Extended</a></li>
	<li><a href="104_jvmdomainmodel.html">Five simple steps to your JVM language</a></li>
		
	<li class="nav-part">Reference Documentation</li>
	<li><a href="301_grammarlanguage.html">The Grammar Language</a></li>
	<li><a href="302_configuration.html">Configuration</a></li>
	<li><a href="303_runtime_concepts.html">Language Implementation</a></li>
	<li><a href="305_xbase.html">Integration with Java</a></li>
	<li><a href="307_special_languages.html">Typical Language Configurations</a></li>
	<li><a href="308_emf_integration.html">Integration with EMF</a></li>
	<li><a href="310_eclipse_support.html">Eclipse Support</a></li>
	<li><a href="330_web_support.html">Web Editor Support</a></li>
	<li><a href="340_lsp_support.html">LSP Support</a></li>
	<li><a href="350_continuous_integration.html">Continuous Integration</a></li>
</ul>
          </div>
          <div class="span8 doc-contents">
            <h1 id="domain-model-walkthrough">15分チュートリアル</h1>

<p>このチュートリアルでは、Rails、GrailsやSpring Rooのように、エンティティとプロパティをモデル化するための小さなドメイン固有言語を実装します。この構文はとても示唆に富んでいます。</p>

<pre><code class="language-domainexample">datatype String

entity Blog {
    title: String
    many posts: Post
}

entity HasAuthor {
    author: String
}

entity Post extends HasAuthor {
    title: String
    content: String
    many comments: Comment
}

entity Comment extends HasAuthor {
    content: String
}
</code></pre>

<p>あなたのマシーンにXtextをインストールした後、Eclipseを起動し、新規workspaceをセットアップします。</p>

<h2 id="新規xtextプロジェクトの作成">新規Xtextプロジェクトの作成</h2>

<p>まず初めに、Eclipseプロジェクトを作る必要があります。Eclipseウィザードから以下の操作を行います。</p>

<p><em>File → New → Project… → Xtext → Xtext project</em></p>

<p>意味のあるプロジェクト名、言語名、そしてファイル拡張子を選びます。例えば</p>

<table>
  <tbody>
    <tr>
      <td><strong>プロジェクト名:</strong></td>
      <td>org.example.domainmodel</td>
    </tr>
    <tr>
      <td><strong>言語名:</strong></td>
      <td>org.example.domainmodel.Domainmodel</td>
    </tr>
    <tr>
      <td><strong>DSL-ファイル拡張子:</strong></td>
      <td>dmodel</td>
    </tr>
  </tbody>
</table>

<p>プロジェクトを作成するため <em>Finish</em> を押してください。</p>

<p><img src="../../documentation/images/30min_wizard.png" alt="" /></p>

<p>ウィザードを正常に終了した後、ワークスペースには5つの新しいプロジェクトが作成されます。</p>

<table>
  <tbody>
    <tr>
      <td>org.example.domainmodel</td>
      <td>文法定義と全ての言語固有コンポーネント(パーサー、字句解析器、リンカー、バリデーションなど)</td>
    </tr>
    <tr>
      <td>org.example.domainmodel.ide</td>
      <td>プラットフォームに依存しないIDE機能 (例 コンテントアシスタントサービス)</td>
    </tr>
    <tr>
      <td>org.example.domainmodel.tests</td>
      <td>言語のユニットテスト</td>
    </tr>
    <tr>
      <td>org.example.domainmodel.ui</td>
      <td>Eclipseエディターと、ワークベンチ関連機能</td>
    </tr>
    <tr>
      <td>org.example.domainmodel.ui.tests</td>
      <td>Eclipseエディター用UIテスト</td>
    </tr>
  </tbody>
</table>

<p><img src="../../documentation/images/30min_initialprojectlayout.png" alt="" /></p>

<h2 id="文法を書く">文法を書く</h2>

<p>エディターで 文法ファイル<em>Domainmodel.xtext</em> を開くと、ウィザードが自動的に開きます。文法ファイルにはシンプルな <em>Hello World</em> 文法が含まれています。</p>

<pre><code class="language-xtext">grammar org.example.domainmodel.Domainmodel with
                                      org.eclipse.xtext.common.Terminals

generate domainmodel "http://www.example.org/domainmodel/Domainmodel"

Model:
    greetings+=Greeting*;
  
Greeting:
    'Hello' name=ID '!';
</code></pre>

<p>さっそく、文法定義をエンティティ言語で置き換えてみましょう。</p>

<pre><code class="language-xtext">grammar org.example.domainmodel.Domainmodel with
                                      org.eclipse.xtext.common.Terminals

generate domainmodel "http://www.example.org/domainmodel/Domainmodel"

Domainmodel:
    (elements+=Type)*;

Type:
    DataType | Entity;

DataType:
    'datatype' name=ID;

Entity:
    'entity' name=ID ('extends' superType=[Entity])? '{'
        (features+=Feature)*
    '}';

Feature:
    (many?='many')? name=ID ':' type=[Type];
</code></pre>

<p>文法ルールの意味を詳しく見ていきましょう。</p>

<ol>
  <li>
    <p>文法の最初のルールは常にスタートルールとして使用されます。</p>

    <pre><code class="language-xtext">Domainmodel:
    (elements+=Type)*;
</code></pre>

    <p>これは、<em>Domainmodel</em> が任意の数の<em>Type</em>を持ち、それらを <code>elements</code>と呼ばれる特性に追加 (<code>+=</code>) することを表しています。</p>
  </li>
  <li>
    <p><em>Type</em> ルールは<em>DataType</em> ルール もしくは (<code>|</code>) <em>Entity</em> ルールに委任します。</p>

    <pre><code class="language-xtext">Type:
    DataType | Entity;
</code></pre>
  </li>
  <li>
    <p><em>DataType</em> ルールは <code>'datatype'</code>キーワードから始まり、<em>ID</em> と呼ばれるルールによってパースされる識別子が続きます。<em>ID</em> ルールは上位文法 <em>org.eclipse.xtext.common.Terminals</em> で定義され、一つの単語(識別子)をパースします。 ルールの呼び出し箇所で <em>F3</em> を押すことで、宣言箇所にジャンプできます。<em>ID</em> の戻り値は 特性<code>name</code>に割り当てられます(<code>=</code>)。</p>

    <pre><code class="language-xtext">DataType:
    'datatype' name=ID;
</code></pre>
  </li>
  <li>
    <p><em>Entity</em> ルールもキーワードの定義から始まり、次に名前が続きます。</p>

    <pre><code class="language-xtext">Entity :
    'entity' name=ID ('extends' superType=[Entity])? '{'
        (features+=Feature)*
    '}';
</code></pre>

    <p>次に かっこで囲まれたオプション (<code>?</code>) の<code>extends</code> 句があります。 特性 <code>superType</code> は クロスリファレンス ( 角かっこに注意 )なので、 パーサールール <em>Entity</em> はここでは呼び出されず、一つの識別子だけが (<em>ID</em> ルール) がパースされます。<code>superType</code> で参照する実際の <em>Entity</em> 割り付けは、リンクフェーズにて解決されます。 最後に、 中かっこの中には、次のルールで呼び出される任意の数の <em>Feature</em> を含めることができます。</p>
  </li>
  <li>
    <p>最後に、 <em>Feature</em> ルール定義は次のとおり:</p>

    <pre><code class="language-xtext">Feature:
    (many?='many')? name=ID ':' type=[Type];
</code></pre>

    <p><code>many</code> キーワードは、複数の値を持つ特性をモデル化するのに使われます。 代入演算子 (<code>?=</code>) は、<code>many</code> の型が <em>boolean</em>であることを意味しています。 その他のパーサールールは既知のものです。</p>
  </li>
</ol>

<p>このエンティティ文法はすでにXtextの文法言語の最も重要な概念を使用しています。 キーワードは文字列リテラルとして記述され、単純な割り当てではイコール (<code>=</code>) が用いられるが、複数値の割り付けにはプラスイコール (<code>+=</code>) が用いられます。 また、真偽値の割り当て符号 (<code>?=</code>) についても確認しました。 さらに、この例では様々な構文要素 (<code>?</code> = オプション, <code>*</code> = 任意の数, <code>+</code> = 少なくとも1つ) を含んでおり、さらにクロスリファレンスのデモを示しています。 詳細は、<a href="301_grammarlanguage.html">文法言語リファレンス</a> を参照してください。 では、これらの言語記述で何ができるのかを見ていきましょう。</p>

<h2 id="言語アーティファクトの生成">言語アーティファクトの生成</h2>

<p>文法の準備が整ったので、様々な言語要素を得るためコード生成を実行する必要があります。コード生成のためには、文法エディター上で右クリックし以下を選択します。</p>

<p><em>Run As → Generate Xtext Artifacts</em>.</p>

<p>この操作によって、パーサー、テキストエディターといくつかの追加のインフラストラクチャコードが生成され、これはらコンソールビューのログメッセージで確認することができます。</p>

<p><img src="../../documentation/images/30min_rungenerator.png" alt="" /></p>

<h2 id="run-generated-plugin">生成されたEclipseプラグインの実行</h2>

<p>Eclipse IDE統合の準備ができました。パッケージエクスプローラのプロジェクト <code>org.example.domainmodel</code> を右クリックし、<em>Run As → Eclipse Application</em>を選択すると、新規run configurationが生成され、新たな言語プラグインが組み込まれた2つ目のEclipseインスタンスが表示されます。表示されたEclipseインスタンスにて<em>File → New → Project… → Java Project</em>を実行し、新規プロジェクトを作成します。その後、拡張子が (<em>*.dmodel</em>) から始まるファイルを作成すると、生成したエンティティエディターが開きます。では、コード補間、シンタックスハイライト、構文チェック、リンクエラー、フォーマッティング、(クイック)アウトラインビュー、ハイパーリンキング、参照の発見、折り畳み、リネームリファクタリングなどの標準機能を確認しましょう。</p>

<p><img src="../../documentation/images/30min_editor.png" alt="" /></p>

<h2 id="add-imports">第2イテレーション: パッケージの追加とインポート</h2>

<p>最初のDSLを生成しエディターの表示を確認したので、言語の改良、機能追加をしていきましょう。domainmodel言語は名前の衝突を避けることとJavaとの親和性を高めるために<em>Packages</em>の概念をサポートする必要があります。<em>Package</em> は <em>Types</em> と他のパッケージを含みます。さらに名前による参照を実現するため、imports宣言も追加します。</p>

<p>最後に、これまで使っていたモデルを異なるファイルに分割します。</p>

<pre><code class="language-domainexample">// datatypes.dmodel

datatype String
</code></pre>

<pre><code class="language-domainexample">// commons.dmodel

package my.company.common {

    entity HasAuthor {
        author: String
    }
}
</code></pre>

<pre><code class="language-domainexample">// blogs.dmodel

package my.company.blog {

    import my.company.common.*

    entity Blog {
        title: String
        many posts: Post
    }

    entity Post extends my.company.common.HasAuthor {
        title: String
        content: String
        many comments: Comment
    }

    entity Comment extends HasAuthor {
        content: String
    }
}
</code></pre>

<p>文法を改良しましょう。</p>

<ol>
  <li>
    <p><em>Domainmodel</em> は型とパッケージは含まれているので、エントリールールを変更する必要があります。さらに、<em>PackageDeclarations</em> と <em>Types</em> に対する上位の共通型(<em>AbstractElement</em>)も導入する必要があります。</p>

    <pre><code class="language-xtext">Domainmodel:
    (elements+=AbstractElement)*;

AbstractElement:
    PackageDeclaration | Type;
</code></pre>
  </li>
  <li>
    <p><code>PackageDeclaration</code>は期待通りに見えます。これは、複数の <em>Imports</em> と <em>AbstractElements</em> を含みます。<em>Imports</em> もまたルートドメインモデルに含まれる必要があるため、<code>AbstractElement</code> のルールに追加します。</p>

    <pre><code class="language-xtext">PackageDeclaration:
    'package' name=QualifiedName '{'
        (elements+=AbstractElement)*
    '}';

AbstractElement:
    PackageDeclaration | Type | Import;
    
QualifiedName:
    ID ('.' ID)*;
</code></pre>

    <p><code>QualifiedName</code> は少し特殊で、割り当てが含まれません。したがって、これは文字列を返すデータタイプルールを提供します。よって、 <em>Package</em>の<code>name</code>特性は<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html">String</a>型のままです。</p>
  </li>
  <li>
    <p>ImportsはXtextによってとても簡単に定義することができます。パーサールールで<code>importedNamespace</code>という名前を用いると、フレームワークはimportとして処理します。これはワイルドカードもサポートしています。</p>

    <pre><code class="language-xtext">Import:
    'import' importedNamespace=QualifiedNameWithWildcard;

QualifiedNameWithWildcard:
    QualifiedName '.*'?;
</code></pre>

    <p><code>QualifiedName</code>と同様に、<code>QualifiedNameWithWildcard</code>もまたもプレーン文字列を返します。</p>
  </li>
  <li>
    <p>最後のステップでは、完全修飾名をクロスリファレンスでも使用できるようにします。これがないと、importを常に記載しないとエンティティの参照ができなくなります。</p>

    <pre><code class="language-xtext">Entity:
    'entity' name=ID ('extends' superType=[Entity|QualifiedName])? '{'
        (features+=Feature)*
    '}';

Feature:
    (many?='many')? name=ID ':' type=[Type|QualifiedName];
</code></pre>

    <p>(<code>|</code>)はクロスリファレンスの対象ではなく、パースされた文字列の構文を指定するために用いられることに注意してください。</p>
  </li>
</ol>

<p>文法は以上です。最終的に以下のようになります。</p>

<pre><code class="language-xtext">grammar org.example.domainmodel.Domainmodel with
                                      org.eclipse.xtext.common.Terminals

generate domainmodel "http://www.example.org/domainmodel/Domainmodel"

Domainmodel:
    (elements+=AbstractElement)*;

PackageDeclaration:
    'package' name=QualifiedName '{'
        (elements+=AbstractElement)*
    '}';

AbstractElement:
    PackageDeclaration | Type | Import;

QualifiedName:
    ID ('.' ID)*;

Import:
    'import' importedNamespace=QualifiedNameWithWildcard;

QualifiedNameWithWildcard:
    QualifiedName '.*'?;

Type:
    DataType | Entity;

DataType:
    'datatype' name=ID;

Entity:
    'entity' name=ID ('extends' superType=[Entity|QualifiedName])? '{'
        (features+=Feature)*
    '}';

Feature:
    (many?='many')? name=ID ':' type=[Type|QualifiedName];
</code></pre>

<p>上記の変更をエディターに反映させるためには、前のセクションで紹介した言語インフラストラクチャの生成を再度行う必要があります。また、モデルを小さなパーツに分割し、ファイルの境界を越えてクロスリファレンスすることも可能です。</p>

<p><img src="../../documentation/images/30min_multipleeditors.png" alt="" /></p>

<hr />

<p><strong><a href="103_domainmodelnextsteps.html">次章: 15分チュートリアル - 拡張</a></strong></p>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>
    
    <footer class="site-footer">
  <div id="extra">
    <div class="inner">
      <div class="container">
        <div class="row">
          <div class="span6">
            <h3 class="footer-links-header">Quick Links</h3>
            <ul class="footer-links clearfix">
              <li><a href="http://www.eclipse.org/legal/privacy.php">Privacy Policy</a></li>
              <li><a href="http://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
              <li><a href="http://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li>
              <li><a href="http://www.eclipse.org/legal/">Legal</a></li>
            </ul>
            <ul class="footer-links clearfix">
              <li><a href="http://www.eclipse.org">Eclipse Home</a></li>
              <li><a href="http://marketplace.eclipse.org/">Market Place</a></li>
              <li><a href="http://www.planeteclipse.org/">Eclipse Planet</a></li>
              <li><a href="https://www.eclipse.org/forums/index.php/f/27/">Xtext Forum</a></li>
            </ul>
          </div>
          <div class="span6">
            <!-- Social Media Links -->
            <h3 class="footer-links-header"">Social Media</h3>
            <ul class="footer-links clearfix">
              <li>
                <a href="https://twitter.com/xtext"><img src="/Xtext/images/Twitter-bird-darkgray.png" class="img-responsive" style="margin-right: 5px;height: 1em;" alt="Twitter icon">@xtext on Twitter</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <a href="#" class="scrollup fadeOutRight animated" style="display: none;">ScrollUp</a>
  <!-- Le javascript
      ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  
  <script src="/Xtext/js/jquery-1.11.3.min.js"></script>
  <script src="/Xtext/js/bootstrap.min.js"></script>
  <script src="/Xtext/js/jquery.easing.1.3.js" type="text/javascript"></script>
  <script src="/Xtext/js/jquery.prettyPhoto.js" type="text/javascript"></script>
  <script src="/Xtext/js/prettify.js" type="text/javascript"></script>
  <script src="/Xtext/js/lang-xtend.js" type="text/javascript"></script>
  <script src="/Xtext/js/lang-common.js" type="text/javascript"></script>
  <script src="/Xtext/js/custom.js" type="text/javascript"></script>
  <!--script src="https://apis.google.com/js/platform.js" async defer></script-->
  <!--script type="text/javascript">
    var _gaq = _gaq || [];  
      _gaq.push([ '_setAccount', 'UA-2429174-3' ]);
    _gaq.push([ '_trackPageview' ]);
    (function() {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl'
          : 'http://www')
          + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
    })();
  </script-->
  <script src="/Xtext/js/coverflow.min.js" type="text/javascript"></script>
  <script>
      $(function() {
        $('#coverflow').coverflow({
          active : 1,
          visibleAside: 2,
          overlap : 0.5,
          scale : 0.9,
          angle : 20,
          trigger : {
            "itemfocus" : true,
            "swipe" : true,
            "mousewheel" : false
          }
        });
        $('#coverflow :hidden').toggle();
        $(window).resize(function() {
          $('#coverflow').coverflow();
        });
      });

  </script>
</footer>


  </body>

</html>
